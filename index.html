<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>WorkoutPal</title>
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link href="https://fonts.googleapis.com/css2?family=Barlow+Condensed:wght@700;800;900&family=Barlow:wght@400;500;600;700&family=DM+Mono:wght@400;500&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <script crossorigin src="https://unpkg.com/react@18/umd/react.production.min.js"></script>
  <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.production.min.js"></script>
  <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>
  <style>
    :root {
      --bg: #f0f0f0;
      --surface: #ffffff;
      --surface2: #f5f5f5;
      --surface3: #e8e8e8;
      --ink: #0a0a0a;
      --volt: #9fcc00;
      --volt-bg: #eefacc;
      --red: #d93025;
      --muted: #757575;
      --border: #e0e0e0;
      --border2: #cacaca;
      --green: #1a7a38;
      --green-bg: #e6f4ea;
      --blue: #1a56a0;
      --blue-bg: #e8f0fe;
      --rest-color: #6d40c4;
      --rest-bg: #ede7f6;
    }
    *, *::before, *::after { box-sizing: border-box; }
    html, body, #root { height: 100%; margin: 0; padding: 0; }
    body { background: var(--bg); font-family: 'Barlow', sans-serif; color: var(--ink); -webkit-font-smoothing: antialiased; }
    .font-display { font-family: 'Barlow Condensed', sans-serif; }
    .font-mono { font-family: 'DM Mono', monospace; }

    .card { background: var(--surface); border: 1px solid var(--border); border-radius: 4px; box-shadow: 0 1px 4px rgba(0,0,0,0.07); }

    .btn-ink {
      background: var(--ink); color: #fff; border: none; border-radius: 2px;
      padding: 12px 24px; font-family: 'Barlow Condensed', sans-serif; font-weight: 800;
      font-size: 15px; letter-spacing: 0.08em; text-transform: uppercase; cursor: pointer;
      transition: opacity 0.12s, transform 0.08s;
    }
    .btn-ink:hover { opacity: 0.82; }
    .btn-ink:active { transform: scale(0.97); }
    .btn-ink:disabled { opacity: 0.3; cursor: not-allowed; }

    /* START button ‚Äî volt background, black text, unmissable */
    .btn-volt {
      background: var(--volt); color: var(--ink); border: none; border-radius: 2px;
      padding: 12px 24px; font-family: 'Barlow Condensed', sans-serif; font-weight: 900;
      font-size: 15px; letter-spacing: 0.08em; text-transform: uppercase; cursor: pointer;
      transition: opacity 0.12s, transform 0.08s;
    }
    .btn-volt:hover { opacity: 0.88; }
    .btn-volt:active { transform: scale(0.97); }
    .btn-volt:disabled { opacity: 0.3; cursor: not-allowed; }

    .btn-ghost {
      background: var(--surface); color: var(--ink); border: 1.5px solid var(--border2); border-radius: 2px;
      padding: 10px 18px; font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
      font-size: 14px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer;
      transition: background 0.12s, border-color 0.12s;
    }
    .btn-ghost:hover { background: var(--surface2); border-color: #aaa; }
    .btn-ghost:disabled { opacity: 0.35; cursor: not-allowed; }

    .btn-danger {
      background: transparent; color: var(--red); border: 1.5px solid #f5c6c3; border-radius: 2px;
      padding: 8px 14px; font-family: 'Barlow Condensed', sans-serif; font-weight: 700;
      font-size: 13px; letter-spacing: 0.06em; text-transform: uppercase; cursor: pointer;
      transition: background 0.12s;
    }
    .btn-danger:hover { background: #fdf0ef; }

    .badge {
      display: inline-flex; align-items: center; border-radius: 2px; padding: 3px 8px;
      font-size: 10px; font-weight: 800; font-family: 'Barlow Condensed', sans-serif;
      letter-spacing: 0.1em; text-transform: uppercase; border: 1.5px solid;
    }
    .badge-gray   { background: var(--surface2); color: var(--muted);      border-color: var(--border2); }
    .badge-green  { background: var(--green-bg); color: var(--green);       border-color: #a8d5b5; }
    .badge-blue   { background: var(--blue-bg);  color: var(--blue);        border-color: #a8c4f0; }
    .badge-purple { background: var(--rest-bg);  color: var(--rest-color);  border-color: #c5b3e6; }

    input[type="text"], input[type="number"], select, textarea {
      font-family: 'Barlow', sans-serif; background: var(--surface); border: 1.5px solid var(--border2);
      border-radius: 2px; padding: 8px 12px; font-size: 14px; color: var(--ink);
      transition: border-color 0.15s; outline: none;
    }
    input[type="text"]:focus, input[type="number"]:focus, select:focus, textarea:focus { border-color: var(--ink); }
    select option { background: var(--surface); color: var(--ink); }
    textarea { resize: vertical; }

    .timer-ring { transform: rotate(-90deg); }
    .timer-ring-bg { stroke: var(--surface3); stroke-width: 10; fill: none; }
    .timer-ring-progress { stroke: var(--ink); stroke-width: 10; fill: none; stroke-linecap: butt; transition: stroke-dashoffset 0.1s linear; }
    .timer-ring-rest .timer-ring-progress { stroke: var(--rest-color); }
    .timer-ring-done .timer-ring-progress { stroke: var(--red); }

    @keyframes flashAnim { 0% { opacity:0; } 12% { opacity:0.9; } 100% { opacity:0; } }
    .flash-overlay {
      position: fixed; inset: 0; z-index: 9000; pointer-events: none;
      background: var(--volt); animation: flashAnim 0.6s ease-out forwards;
    }

    .progress-bar { height: 4px; background: var(--surface3); overflow: hidden; }
    .progress-fill { height: 100%; background: var(--ink); transition: width 0.4s ease; }

    @keyframes fadeIn  { from { opacity:0; transform: translateY(6px);  } to { opacity:1; transform: translateY(0); } }
    @keyframes slideUp { from { opacity:0; transform: translateY(24px); } to { opacity:1; transform: translateY(0); } }
    @keyframes scaleIn { from { opacity:0; transform: scale(0.96);      } to { opacity:1; transform: scale(1);    } }
    .fade-in  { animation: fadeIn  0.2s  ease both; }
    .slide-up { animation: slideUp 0.25s ease both; }
    .scale-in { animation: scaleIn 0.2s  ease both; }

    .cue-card {
      background: var(--volt-bg); border: 1.5px solid #cce870;
      border-left: 4px solid var(--volt); border-radius: 2px; padding: 12px 16px;
    }

    .modal-backdrop {
      position: fixed; inset: 0; background: rgba(0,0,0,0.4);
      display: flex; align-items: center; justify-content: center;
      padding: 16px; z-index: 100; backdrop-filter: blur(6px);
    }
    .modal {
      background: var(--surface); border: 1.5px solid var(--border2); border-radius: 4px;
      box-shadow: 0 24px 80px rgba(0,0,0,0.18); width: 100%; max-width: 580px;
      max-height: 90vh; overflow-y: auto;
    }

    .app-header {
      position: sticky; top: 0; z-index: 10;
      background: rgba(240,240,240,0.95); backdrop-filter: blur(16px);
      border-bottom: 1.5px solid var(--border2);
    }

    .ex-row {
      display: grid; gap: 8px; padding: 12px; background: var(--surface2);
      border: 1.5px solid var(--border); border-radius: 2px; margin-bottom: 6px;
    }

    ::-webkit-scrollbar { width: 4px; }
    ::-webkit-scrollbar-track { background: transparent; }
    ::-webkit-scrollbar-thumb { background: var(--border2); border-radius: 2px; }

    .workout-select {
      appearance: none;
      background-image: url("data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='12' height='12' viewBox='0 0 24 24' fill='none' stroke='%23757575' stroke-width='2.5'%3E%3Cpath d='m6 9 6 6 6-6'/%3E%3C/svg%3E");
      background-repeat: no-repeat; background-position: right 10px center;
      padding-right: 30px; font-weight: 700; font-size: 15px; letter-spacing: 0.01em;
    }

    .block-card { background: var(--surface); border: 1.5px solid var(--border); border-radius: 4px; overflow: hidden; }
    .block-header { padding: 14px 16px; display: flex; justify-content: space-between; align-items: center; border-bottom: 1.5px solid var(--border); background: var(--surface2); }
  </style>
</head>
<body>
  <div id="root"></div>

  <script type="text/babel" data-presets="env,react" data-plugins="proposal-optional-chaining">

    // ---------- AUDIO ‚Äî REMOVED ----------
    // HTML Audio interrupts iOS media playback (Spotify etc). Screen flash is used instead.
    function playChime() {} // no-op kept so call sites compile

    // ---------- FLASH OVERLAY ----------
    function FlashOverlay({ trigger }) {
      const [visible, setVisible] = React.useState(false);
      const prev = React.useRef(0);
      React.useEffect(() => {
        if (trigger > prev.current) {
          prev.current = trigger;
          setVisible(true);
          setTimeout(() => setVisible(false), 650);
        }
      }, [trigger]);
      return visible ? <div className="flash-overlay" /> : null;
    }

    // ---------- HOOKS ----------
    function useLocalStorage(key, init) {
      const [s, setS] = React.useState(() => {
        try { const r = window.localStorage.getItem(key); return r != null ? JSON.parse(r) : init; } catch { return init; }
      });
      React.useEffect(() => { try { window.localStorage.setItem(key, JSON.stringify(s)); } catch {} }, [key, s]);
      return [s, setS];
    }

    const toMs = (sec) => Math.max(0, Math.round(Number(sec||0)*1000));

    function useCountdown(ms, running) {
      const [rem, setRem] = React.useState(ms);
      const raf = React.useRef(null);
      const startRef = React.useRef(null);
      React.useEffect(() => { setRem(ms); }, [ms]);
      React.useEffect(() => {
        if (!running) { cancelAnimationFrame(raf.current); return; }
        const startRem = rem;
        startRef.current = performance.now();
        const loop = (t) => {
          const next = Math.max(0, startRem - (t - startRef.current));
          setRem(next);
          if (next > 0) raf.current = requestAnimationFrame(loop);
        };
        raf.current = requestAnimationFrame(loop);
        return () => cancelAnimationFrame(raf.current);
      }, [running]);
      return [rem];
    }

    // ---------- SMART IMPORT ----------
    function autoFix(raw) {
      let data;
      try { data = JSON.parse(raw); }
      catch {
        const c = raw.replace(/^```[a-z]*\n?/gm,'').replace(/```$/gm,'').trim();
        try { data = JSON.parse(c); } catch(e) { return { ok:false, error:'Could not parse JSON: '+e.message }; }
      }
      const arr = Array.isArray(data) ? data : [data];
      const fixed=[], errors=[];
      arr.forEach((obj,wi) => {
        if (!obj||typeof obj!=='object') { errors.push(`Item ${wi+1}: not an object`); return; }
        const title = obj.title||obj.name||obj.workout_name||obj.workoutName||`Workout ${wi+1}`;
        const cats = obj.categories||obj.blocks||obj.sections||obj.exercises_by_block||[];
        if (!Array.isArray(cats)) { errors.push(`"${title}": no categories`); return; }
        const fixedCats=[], catErr=[];
        cats.forEach((blk,bi) => {
          if (!blk||typeof blk!=='object') { catErr.push(`Block ${bi+1}: not object`); return; }
          const bname = blk.name||blk.block_name||blk.blockName||blk.category||`Block ${bi+1}`;
          const rounds = Number(blk.rounds||blk.sets||blk.round_count||1);
          const exArr = blk.exercises||blk.movements||blk.exercise_list||blk.items||[];
          if (!Array.isArray(exArr)) { catErr.push(`"${bname}": no exercises`); return; }
          const fixedEx=[];
          exArr.forEach((ex,ei) => {
            if (!ex||typeof ex!=='object') return;
            const desc = ex.description||ex.name||ex.exercise||ex.movement||ex.title||`Ex ${ei+1}`;
            let dur = ex.duration||ex.time||ex.seconds||ex.reps||ex.count||ex.duration_seconds||10;
            if (typeof dur==='string') dur = parseFloat(dur.replace(/[^0-9.]/g,''))||10;
            dur = Number(dur);
            let unit = (ex.unit||ex.type||'').toString().toLowerCase();
            if (/rep|count|times|x/.test(unit)) unit='reps';
            else if (/sec|time|hold|s$/.test(unit)) unit='seconds';
            else if (ex.reps&&!ex.duration) unit='reps';
            else unit='seconds';
            const instructions = ex.instructions||ex.cues||ex.coaching||ex.notes||ex.form_cues||'';
            fixedEx.push({ description:desc, duration:dur, unit, instructions });
          });
          if (!fixedEx.length) { catErr.push(`"${bname}": no exercises`); return; }
          fixedCats.push({ name:bname, rounds:Math.max(1,rounds), exercises:fixedEx });
        });
        if (!fixedCats.length) { errors.push(`"${title}": ${catErr.join('; ')}`); return; }
        fixed.push({ workout:{ title, categories:fixedCats }, warnings: catErr.length ? catErr.join('; ') : '' });
      });
      if (!fixed.length) return { ok:false, error:errors.join('\n') };
      return { ok:true, workouts:fixed.map(f=>f.workout), warnings:fixed.flatMap(f=>f.warnings?[f.warnings]:[]) };
    }

    // ---------- AI PROMPT ----------
    const AI_PROMPT = `Please generate a workout plan and return it as a JSON object (no extra explanation, just the raw JSON).

Use exactly this structure:
{
  "title": "Workout Name",
  "categories": [
    {
      "name": "Block Name",
      "rounds": 3,
      "exercises": [
        {
          "description": "Exercise Name",
          "duration": 45,
          "unit": "seconds",
          "instructions": "Key coaching cues ‚Äî what to focus on, what to avoid, form reminders."
        },
        {
          "description": "Another Exercise",
          "duration": 12,
          "unit": "reps",
          "instructions": "Coaching cues here."
        }
      ]
    }
  ]
}

Rules:
- "unit" must be exactly "seconds" or "reps" (no other values)
- "duration" must be a number (not a string like "30s")
- "rounds" must be a number (how many times to repeat the block)
- "instructions" should include practical form cues: what to focus on, common mistakes to avoid, what the movement should feel like
- Include a warm-up block (rounds: 1), 1-3 main blocks (rounds: 2-4), and a cooldown block (rounds: 1)
- Return only the JSON - no markdown, no code fences, no explanation`;

    // ---------- LIBRARY ----------
    const INITIAL_LIBRARY = [
      {
        title: "Arm & Ab Workout",
        categories: [
          { name: "Warm-Up", rounds: 1, exercises: [
            { description: "Arm Circles", duration: 30, unit: "seconds", instructions: "Small to large circles, forward and backward. Keep shoulders relaxed, not hunched." },
            { description: "Cat-Cow", duration: 6, unit: "reps", instructions: "Breathe with movement; exhale to arch (cat), inhale to drop (cow). Move through full spine ‚Äî don't just move the neck." },
            { description: "Torso Twists", duration: 20, unit: "reps", instructions: "Rotate from the ribcage, not just the arms. Keep hips square and facing forward." }
          ]},
          { name: "Core (Mat)", rounds: 3, exercises: [
            { description: "Plank Hold", duration: 45, unit: "seconds", instructions: "Elbows directly under shoulders. Press ribs DOWN ‚Äî no banana back. Squeeze glutes. Chin tucked ‚Äî neutral neck." },
            { description: "Bicycle Crunches", duration: 20, unit: "reps", instructions: "Shoulder (not elbow) reaches toward knee. Go SLOW ‚Äî speed kills form. Exhale on each twist. Lower back pressed into mat." },
            { description: "Russian Twists", duration: 20, unit: "reps", instructions: "Neutral spine ‚Äî don't round the back. Rotate from the ribcage. Tap the floor on each side." }
          ]},
          { name: "Upper Body (Weights)", rounds: 3, exercises: [
            { description: "Dumbbell Curl to Press", duration: 12, unit: "reps", instructions: "No swinging. Rotate to neutral grip before pressing. Ribs stay locked down ‚Äî don't arch." },
            { description: "Bench Dips", duration: 12, unit: "reps", instructions: "Shoulders DOWN and BACK. Stop at ~90¬∞ elbow. Full lockout at the top." },
            { description: "Hammer Curls", duration: 12, unit: "reps", instructions: "Elbows pinned at your sides. Neutral grip throughout. Control the negative." }
          ]},
          { name: "Cooldown", rounds: 1, exercises: [
            { description: "Seated Forward Fold", duration: 45, unit: "seconds", instructions: "Hinge at hips, not the waist. Soft knees. Let neck and jaw completely relax." },
            { description: "Cross-Body Shoulder", duration: 30, unit: "seconds", instructions: "Gently pull arm across chest. Keep shoulder DOWN ‚Äî don't let it shrug." },
            { description: "Child's Pose", duration: 45, unit: "seconds", instructions: "Sit back toward heels. Reach arms long. Try to get longer with each exhale." }
          ]}
        ]
      },
      {
        title: "Leg & Glute Workout",
        categories: [
          { name: "Warm-Up", rounds: 1, exercises: [
            { description: "Bodyweight Squats", duration: 12, unit: "reps", instructions: "Feet shoulder-width, toes slightly out. Sit BACK ‚Äî weight on mid-foot and heels. Chest tall." },
            { description: "Hip Circles", duration: 30, unit: "seconds", instructions: "Hands on hips. Draw big deliberate circles. Both directions equally." },
            { description: "Leg Swings", duration: 10, unit: "reps", instructions: "Front to back. Brace core. Start small, build range gradually." }
          ]},
          { name: "Glute Activation (Mat)", rounds: 3, exercises: [
            { description: "Glute Bridge", duration: 15, unit: "reps", instructions: "Drive through HEELS, not toes. Pause and SQUEEZE at the top. Don't let the lower back take over." },
            { description: "Clamshells", duration: 15, unit: "reps", instructions: "Band above knees. Stack your hips ‚Äî don't roll back. Feel this in the glute, not the hip flexor." },
            { description: "Side Plank Hip Lifts", duration: 12, unit: "reps", instructions: "Elbow under shoulder. Lift straight up ‚Äî don't twist. Keep hips square." }
          ]},
          { name: "Leg Strength (Weights)", rounds: 3, exercises: [
            { description: "Bulgarian Split Squat", duration: 12, unit: "reps", instructions: "Long stance ‚Äî front shin vertical at bottom. Torso tall. Drive through front heel." },
            { description: "Step Ups", duration: 12, unit: "reps", instructions: "Full foot on bench. Drive through the HEEL of the raised foot. Control the step down." },
            { description: "Romanian Deadlift", duration: 12, unit: "reps", instructions: "FLAT BACK ‚Äî this is the whole exercise. Hinge at hips. Weights stay close to legs." },
            { description: "Squat Jumps", duration: 15, unit: "reps", instructions: "Land SOFT ‚Äî think quiet feet. Chest stays tall. Explosive power AND controlled landing." }
          ]},
          { name: "Cooldown", rounds: 1, exercises: [
            { description: "Standing Quad", duration: 30, unit: "seconds", instructions: "Knees together. Slight posterior tilt to deepen stretch. Stand tall." },
            { description: "Figure-4 Stretch", duration: 30, unit: "seconds", instructions: "Cross ankle over opposite knee. Sit back. Keep spine long ‚Äî don't round." },
            { description: "Seated Hamstring", duration: 45, unit: "seconds", instructions: "Hinge FORWARD from the hip. Don't round the back to reach. Relax the hamstring with each exhale." }
          ]}
        ]
      }
    ];

    function buildSchedule(blocks, restSec) {
      const steps = [];
      (blocks||[]).forEach((blk,bi) => {
        const rounds = Math.max(1, Number(blk.rounds||1));
        for (let r=1; r<=rounds; r++) {
          (blk.exercises||[]).forEach((_,ei) => steps.push({ type:'exercise', bi, ri:r, ei }));
          if (r < rounds) steps.push({ type:'rest', bi, ri:r, duration:restSec });
        }
      });
      return steps;
    }

    // ---------- EDITOR ----------
    function ExerciseEditor({ ex, onChange, onDelete }) {
      return (
        <div className="ex-row">
          <div style={{ display:'grid', gridTemplateColumns:'1fr 72px 90px', gap:'8px', alignItems:'center' }}>
            <input type="text" value={ex.description} placeholder="Exercise name"
              onChange={e => onChange({ ...ex, description:e.target.value })} style={{ width:'100%' }} />
            <input type="number" min={1} value={ex.duration}
              onChange={e => onChange({ ...ex, duration:Number(e.target.value)||1 })}
              style={{ width:'100%', textAlign:'right' }} />
            <select value={ex.unit} onChange={e => onChange({ ...ex, unit:e.target.value })} style={{ width:'100%' }}>
              <option value="seconds">sec</option>
              <option value="reps">reps</option>
            </select>
          </div>
          <textarea value={ex.instructions||''} rows={2}
            placeholder="Coaching cues (flat back, drive through heels, shoulders down...)"
            onChange={e => onChange({ ...ex, instructions:e.target.value })}
            style={{ width:'100%', fontSize:'13px' }} />
          <button className="btn-danger" onClick={onDelete} style={{ fontSize:'11px', padding:'4px 10px' }}>Remove</button>
        </div>
      );
    }

    function BlockEditor({ blk, onChange, onDelete }) {
      const upEx = (ei,u) => { const e=[...blk.exercises]; e[ei]=u; onChange({...blk,exercises:e}); };
      const delEx = (ei) => onChange({ ...blk, exercises:blk.exercises.filter((_,i)=>i!==ei) });
      const addEx = () => onChange({ ...blk, exercises:[...blk.exercises,{description:'',duration:30,unit:'seconds',instructions:''}] });
      return (
        <div style={{ background:'var(--surface)', border:'1px solid var(--border2)', borderRadius:'4px', padding:'16px', marginBottom:'12px' }}>
          <div style={{ display:'flex', gap:'10px', alignItems:'center', marginBottom:'12px', flexWrap:'wrap' }}>
            <input type="text" value={blk.name} placeholder="Block name"
              onChange={e => onChange({...blk,name:e.target.value})} style={{ flex:1, minWidth:'140px', fontWeight:700 }} />
            <div style={{ display:'flex', alignItems:'center', gap:'8px' }}>
              <span style={{ fontSize:'11px', color:'var(--muted)', textTransform:'uppercase', letterSpacing:'0.08em' }}>Rounds</span>
              <input type="number" min={1} max={10} value={blk.rounds}
                onChange={e => onChange({...blk,rounds:Math.max(1,Number(e.target.value)||1)})}
                style={{ width:'60px', textAlign:'center' }} />
            </div>
            <button className="btn-danger" onClick={onDelete}>Delete</button>
          </div>
          {blk.exercises.map((ex,ei) => (
            <ExerciseEditor key={ei} ex={ex} onChange={u=>upEx(ei,u)} onDelete={()=>delEx(ei)} />
          ))}
          <button className="btn-ghost" onClick={addEx} style={{ marginTop:'4px', fontSize:'12px', padding:'7px 14px' }}>+ ADD EXERCISE</button>
        </div>
      );
    }

    // ---------- IMPORT MODAL ----------
    function ImportModal({ onClose, onImport }) {
      const [text, setText] = React.useState('');
      const [result, setResult] = React.useState(null);
      const [copied, setCopied] = React.useState(false);

      const tryFix = () => { if (text.trim()) setResult(autoFix(text)); };
      const doImport = () => { if (result?.ok) onImport(result.workouts); };
      const copyPrompt = () => {
        navigator.clipboard.writeText(AI_PROMPT)
          .then(() => { setCopied(true); setTimeout(()=>setCopied(false),2500); })
          .catch(() => {
            const el=document.createElement('textarea'); el.value=AI_PROMPT;
            document.body.appendChild(el); el.select(); document.execCommand('copy');
            document.body.removeChild(el); setCopied(true); setTimeout(()=>setCopied(false),2500);
          });
      };

      return (
        <div className="modal-backdrop" onClick={e=>{ if(e.target===e.currentTarget) onClose(); }}>
          <div className="modal slide-up">
            <div style={{ padding:'20px 24px', borderBottom:'1px solid var(--border)', display:'flex', justifyContent:'space-between', alignItems:'center' }}>
              <span className="font-display" style={{ fontSize:'22px', fontWeight:900, letterSpacing:'0.04em', textTransform:'uppercase' }}>Import Workout</span>
              <button className="btn-ghost" style={{ padding:'6px 12px', fontSize:'12px' }} onClick={onClose}>CLOSE</button>
            </div>
            <div style={{ padding:'20px 24px' }}>
              {/* Step 1 */}
              <div style={{ background:'var(--volt-bg)', border:'1.5px solid #cce870', borderRadius:'4px', padding:'16px', marginBottom:'20px' }}>
                <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', gap:'12px' }}>
                  <div>
                    <div style={{ fontSize:'10px', fontWeight:800, letterSpacing:'0.1em', textTransform:'uppercase', color:'#5a7a00', marginBottom:'4px' }}>Step 1</div>
                    <div style={{ fontSize:'14px', fontWeight:600, marginBottom:'4px', color:'var(--ink)' }}>Ask an AI to generate a workout</div>
                    <div style={{ fontSize:'12px', color:'var(--muted)', lineHeight:1.5 }}>
                      Copy the prompt, paste into ChatGPT or Claude, then add your request ‚Äî{' '}
                      <em style={{ color:'var(--ink)' }}>"30-min upper body, 3 rounds, dumbbells only"</em>
                    </div>
                  </div>
                  <button onClick={copyPrompt} style={{
                    flexShrink:0, background:copied?'var(--green-bg)':'var(--ink)',
                    color:copied?'var(--green)':'#fff', border:copied?'1.5px solid #a8d5b5':'none',
                    borderRadius:'2px', padding:'10px 16px', fontSize:'12px', fontWeight:800,
                    cursor:'pointer', fontFamily:'Barlow Condensed,sans-serif', letterSpacing:'0.08em',
                    textTransform:'uppercase', transition:'all 0.2s', whiteSpace:'nowrap'
                  }}>
                    {copied ? '‚úì COPIED' : 'COPY PROMPT'}
                  </button>
                </div>
                <div className="font-mono" style={{
                  marginTop:'12px', fontSize:'11px', color:'var(--muted)',
                  background:'var(--surface)', border:'1px solid var(--border2)', borderRadius:'2px',
                  padding:'10px', maxHeight:'70px', overflow:'hidden', position:'relative',
                  lineHeight:1.5, userSelect:'none'
                }}>
                  {AI_PROMPT.slice(0,180)}‚Ä¶
                  <div style={{ position:'absolute', bottom:0, left:0, right:0, height:'28px', background:'linear-gradient(transparent, var(--surface))' }} />
                </div>
              </div>

              {/* Step 2 */}
              <div style={{ fontSize:'10px', fontWeight:800, letterSpacing:'0.1em', textTransform:'uppercase', color:'var(--ink)', marginBottom:'8px' }}>Step 2 ‚Äî Paste JSON</div>
              <textarea className="font-mono"
                style={{ width:'100%', height:'160px', fontSize:'12px', padding:'12px' }}
                placeholder={'{\n  "title": "My Workout",\n  "categories": [...]\n}'}
                value={text} onChange={e=>{ setText(e.target.value); setResult(null); }} />

              {result && (
                <div style={{
                  marginTop:'12px', padding:'12px', borderRadius:'2px', fontSize:'13px',
                  background: result.ok ? 'var(--green-bg)' : '#fdf0ef',
                  border: `1.5px solid ${result.ok ? '#a8d5b5' : '#f5c6c3'}`,
                  color: result.ok ? 'var(--green)' : 'var(--red)'
                }}>
                  {result.ok ? (
                    <>
                      <div style={{ fontWeight:700, marginBottom:'6px' }}>‚úì READY ‚Äî {result.workouts.length} workout{result.workouts.length>1?'s':''}</div>
                      {result.warnings.length>0 && <div style={{ color:'#b45309', marginBottom:'4px' }}>‚ö† {result.warnings.join('; ')}</div>}
                      <ul style={{ margin:0, paddingLeft:'16px', color:'var(--ink)', fontSize:'13px' }}>
                        {result.workouts.map((w,i)=><li key={i}>{w.title} ‚Äî {w.categories.length} blocks, {w.categories.reduce((s,c)=>s+c.exercises.length,0)} exercises</li>)}
                      </ul>
                    </>
                  ) : (
                    <>
                      <div style={{ fontWeight:700, marginBottom:'6px' }}>‚úó COULD NOT PARSE</div>
                      <div style={{ whiteSpace:'pre-wrap', fontFamily:'DM Mono,monospace', fontSize:'12px', color:'var(--muted)' }}>{result.error}</div>
                    </>
                  )}
                </div>
              )}

              <div style={{ display:'flex', justifyContent:'flex-end', gap:'10px', marginTop:'16px' }}>
                <button className="btn-ghost" onClick={onClose}>CANCEL</button>
                {!result?.ok && <button className="btn-ghost" style={{ background:'var(--ink)', color:'#fff', border:'none' }} onClick={tryFix} disabled={!text.trim()}>VALIDATE & FIX</button>}
                {result?.ok  && <button className="btn-ink"  onClick={doImport}>IMPORT ‚úì</button>}
              </div>
            </div>
          </div>
        </div>
      );
    }

    // ---------- BIG TIMER ----------
    function BigTimer({ ms, running, onToggle, onComplete, isRest, done }) {
      const [rem] = useCountdown(ms, running);
      const seconds = Math.ceil(rem / 1000);
      const progress = ms > 0 ? rem / ms : 0;
      const R = 58, circ = 2 * Math.PI * R;
      const prev = React.useRef(rem);
      React.useEffect(() => {
        if (prev.current > 0 && rem === 0) onComplete?.();
        prev.current = rem;
      }, [rem]);

      return (
        <div style={{ display:'flex', flexDirection:'column', alignItems:'center', gap:'20px', marginTop:'28px' }}>
          <div style={{ position:'relative', width:150, height:150 }}>
            <svg width={150} height={150} viewBox="0 0 150 150"
              className={`timer-ring${isRest?' timer-ring-rest':''}${done?' timer-ring-done':''}`}>
              <circle className="timer-ring-bg" cx={75} cy={75} r={R} />
              <circle className="timer-ring-progress" cx={75} cy={75} r={R}
                strokeDasharray={circ} strokeDashoffset={circ - circ*progress} />
            </svg>
            <div style={{ position:'absolute', inset:0, display:'flex', flexDirection:'column', alignItems:'center', justifyContent:'center' }}>
              <span className="font-display" style={{
                fontSize: seconds>=100?'44px':'60px', fontWeight:900, lineHeight:1,
                color: done ? 'var(--red)' : isRest ? 'var(--rest-color)' : 'var(--ink)'
              }}>{seconds}</span>
              <span style={{ fontSize:'10px', color:'var(--muted)', marginTop:'3px', letterSpacing:'0.12em', textTransform:'uppercase', fontWeight:700 }}>
                {isRest ? 'rest' : 'sec'}
              </span>
            </div>
          </div>
          <button className={running ? 'btn-ghost' : (isRest ? 'btn-ghost' : 'btn-ink')}
            onClick={onToggle} style={{ minWidth:'120px', fontSize:'13px' }}>
            {running ? '‚è∏ PAUSE' : '‚ñ∂ START'}
          </button>
        </div>
      );
    }

    // ---------- REST SCREEN ----------
    function RestScreen({ duration, onSkip, setFlashTrigger }) {
      const ms = toMs(duration);
      const [running, setRunning] = React.useState(true);
      const [done, setDone] = React.useState(false);
      return (
        <div className="card scale-in" style={{ padding:'32px 24px', textAlign:'center' }}>
          <span className="badge badge-purple" style={{ marginBottom:'16px' }}>REST</span>
          <div className="font-display" style={{ fontSize:'40px', fontWeight:900, textTransform:'uppercase', letterSpacing:'0.02em', lineHeight:1 }}>Take a breather</div>
          <div style={{ color:'var(--muted)', fontSize:'14px', marginTop:'6px' }}>Next round coming up</div>
          <BigTimer ms={ms} running={running} onToggle={()=>setRunning(r=>!r)}
            onComplete={()=>{ setFlashTrigger(t=>t+1); setDone(true); }}
            isRest={true} done={done} />
          {done && <div style={{ color:'var(--rest-color)', marginTop:'16px', fontWeight:800, fontSize:'13px', letterSpacing:'0.08em', textTransform:'uppercase' }}>Rest complete ‚Äî let's go</div>}
          <button className="btn-ghost" onClick={onSkip} style={{ marginTop:'24px', fontSize:'12px' }}>SKIP REST ‚Üí</button>
        </div>
      );
    }

    // ---------- APP ----------
    function App() {
      const [library, setLibrary] = useLocalStorage("workout_library_v3", INITIAL_LIBRARY);
      const [currentIndex, setCurrentIndex] = useLocalStorage("workout_current_index_v3", 0);
      const [mode, setMode] = useLocalStorage("wp_mode", "PLAN");
      const [restSeconds, setRestSeconds] = useLocalStorage("wp_rest_seconds", 30);
      const [editMode, setEditMode] = React.useState(false);
      const [editDraft, setEditDraft] = React.useState(null);
      const [showImport, setShowImport] = React.useState(false);
      const [banner, setBanner] = React.useState(null);
      const [flashTrigger, setFlashTrigger] = React.useState(0);

      const safeIdx = Math.min(currentIndex, library.length-1);
      const workout = library[safeIdx] || INITIAL_LIBRARY[0];
      const blocks  = workout.categories || [];

      const [schedule, setSchedule] = React.useState([]);
      const [idx, setIdx] = React.useState(0);
      const cur = schedule[idx];
      const curEx   = cur?.type==='exercise' ? cur : null;
      const curRest = cur?.type==='rest'     ? cur : null;
      const curBlock = curEx ? blocks[curEx.bi] : null;
      const current  = curEx && curBlock ? curBlock.exercises?.[curEx.ei] : null;

      const [running, setRunning] = React.useState(false);
      const [timerDone, setTimerDone] = React.useState(false);
      const [seed, setSeed] = React.useState(0);

      React.useEffect(()=>{ setRunning(false); setTimerDone(false); setSeed(s=>s+1); },[idx]);

      const showBanner = (msg,ms=4000) => { setBanner(msg); setTimeout(()=>setBanner(null),ms); };
      const startRun = () => { setSchedule(buildSchedule(blocks,restSeconds)); setIdx(0); setMode('RUN'); };
      const next = () => { if(idx+1<schedule.length) setIdx(idx+1); else setMode('PLAN'); };
      const prev = () => { if(idx>0) setIdx(idx-1); };

      const openEdit = () => { setEditDraft(JSON.parse(JSON.stringify(workout))); setEditMode(true); };
      const cancelEdit = () => { setEditMode(false); setEditDraft(null); };
      const saveEdit = () => {
        const nl=[...library]; nl[safeIdx]=editDraft; setLibrary(nl);
        setEditMode(false); setEditDraft(null); showBanner('Saved.');
      };
      const deleteWorkout = () => {
        if(library.length<=1){ showBanner('Cannot delete the last workout.'); return; }
        if(!confirm(`Delete "${workout.title}"?`)) return;
        const nl=library.filter((_,i)=>i!==safeIdx);
        setLibrary(nl); setCurrentIndex(Math.max(0,safeIdx-1)); showBanner('Deleted.');
      };
      const handleImport = (workouts) => {
        const nl=[...library,...workouts]; setLibrary(nl);
        setCurrentIndex(nl.length-workouts.length); setShowImport(false);
        showBanner(`Imported ${workouts.length} workout${workouts.length>1?'s':''}.`);
      };

      const progressPct = schedule.length>0 ? (idx/schedule.length)*100 : 0;

      return (
        <div style={{ minHeight:'100vh' }}>
          <FlashOverlay trigger={flashTrigger} />

          {/* ‚îÄ‚îÄ HEADER ‚îÄ‚îÄ */}
          <header className="app-header">
            <div style={{ maxWidth:'680px', margin:'0 auto', padding:'12px 16px 10px', display:'flex', flexDirection:'column', gap:'8px' }}>
              <div style={{ display:'flex', alignItems:'center', gap:'12px' }}>
                <span className="font-display" style={{ fontSize:'22px', fontWeight:900, color:'var(--volt)', letterSpacing:'0.04em', flexShrink:0 }}>WP</span>
                {mode==='PLAN' && !editMode && (
                  <select className="workout-select" value={safeIdx}
                    onChange={e=>setCurrentIndex(Number(e.target.value))}
                    style={{ flex:1, minWidth:0, background:'var(--surface)', color:'var(--ink)' }}>
                    {library.map((w,i)=><option key={i} value={i}>{w.title}</option>)}
                  </select>
                )}
                {editMode && (
                  <input type="text" value={editDraft?.title||''} placeholder="Workout title"
                    onChange={e=>setEditDraft(d=>({...d,title:e.target.value}))}
                    style={{ flex:1, fontWeight:700, fontSize:'15px' }} />
                )}
                {mode==='RUN' && (
                  <>
                    <span className="font-display" style={{ fontSize:'16px', fontWeight:800, flex:1, overflow:'hidden', textOverflow:'ellipsis', whiteSpace:'nowrap', textTransform:'uppercase', letterSpacing:'0.04em' }}>{workout.title}</span>
                    <button className="btn-ghost" style={{ flexShrink:0, fontSize:'12px', padding:'7px 14px' }} onClick={()=>setMode('PLAN')}>EXIT</button>
                  </>
                )}
              </div>

              {mode==='PLAN' && !editMode && (
                <div style={{ display:'flex', gap:'8px' }}>
                  <button className="btn-ghost" style={{ flex:1, fontSize:'12px', padding:'9px' }} onClick={()=>setShowImport(true)}>IMPORT</button>
                  <button className="btn-ghost" style={{ flex:1, fontSize:'12px', padding:'9px' }} onClick={openEdit}>EDIT</button>
                  <button className="btn-volt"  style={{ flex:1, fontSize:'13px', padding:'9px' }} onClick={startRun}>START ‚ñ∂</button>
                </div>
              )}
              {editMode && (
                <div style={{ display:'flex', gap:'8px' }}>
                  <button className="btn-ghost" style={{ flex:1 }} onClick={cancelEdit}>CANCEL</button>
                  <button className="btn-ink"  style={{ flex:1 }} onClick={saveEdit}>SAVE</button>
                </div>
              )}
            </div>

            {mode==='RUN' && (
              <div className="progress-bar"><div className="progress-fill" style={{ width:`${progressPct}%` }} /></div>
            )}

            {banner && (
              <div style={{ maxWidth:'680px', margin:'0 auto', padding:'0 16px 10px' }}>
                <div style={{ fontSize:'12px', padding:'8px 12px', borderRadius:'2px', background:'var(--volt-bg)', border:'1.5px solid #cce870', color:'#5a7a00', letterSpacing:'0.04em' }}>{banner}</div>
              </div>
            )}
          </header>

          <main style={{ maxWidth:'680px', margin:'0 auto', padding:'20px 16px 60px' }}>

            {/* ‚îÄ‚îÄ PLAN ‚îÄ‚îÄ */}
            {mode==='PLAN' && !editMode && (
              <div className="fade-in">
                <div style={{ display:'flex', justifyContent:'space-between', alignItems:'flex-start', marginBottom:'20px' }}>
                  <div>
                    <h1 className="font-display" style={{ fontSize:'clamp(28px,7vw,40px)', fontWeight:900, textTransform:'uppercase', letterSpacing:'0.02em', margin:0, lineHeight:1 }}>{workout.title}</h1>
                    <div style={{ fontSize:'11px', color:'var(--muted)', marginTop:'5px', textTransform:'uppercase', letterSpacing:'0.08em' }}>
                      {blocks.length} blocks ¬∑ {blocks.reduce((s,b)=>s+b.exercises.length,0)} exercises
                    </div>
                  </div>
                  <div style={{ display:'flex', alignItems:'center', gap:'8px', flexShrink:0 }}>
                    <span style={{ fontSize:'11px', color:'var(--muted)', textTransform:'uppercase', letterSpacing:'0.06em' }}>Rest</span>
                    <select value={restSeconds} onChange={e=>setRestSeconds(Number(e.target.value))} style={{ fontSize:'13px', padding:'6px 10px' }}>
                      {[15,30,45,60,90].map(s=><option key={s} value={s}>{s}s</option>)}
                    </select>
                  </div>
                </div>

                <div style={{ display:'flex', flexDirection:'column', gap:'10px' }}>
                  {blocks.map((blk,bi) => {
                    const isMat=/mat/i.test(blk.name), isW=/weight/i.test(blk.name);
                    return (
                      <div key={bi} className="block-card">
                        <div className="block-header">
                          <div style={{ display:'flex', alignItems:'center', gap:'10px' }}>
                            <span className="font-display" style={{ fontSize:'18px', fontWeight:800, textTransform:'uppercase', letterSpacing:'0.04em' }}>{blk.name}</span>
                            <span className={`badge ${isMat?'badge-green':isW?'badge-blue':'badge-gray'}`}>{isMat?'MAT':isW?'WEIGHTS':'BLOCK'}</span>
                          </div>
                          <span style={{ fontSize:'13px', color:'var(--ink)', fontWeight:800, fontFamily:'Barlow Condensed,sans-serif', letterSpacing:'0.06em' }}>{blk.rounds}√ó</span>
                        </div>
                        <div style={{ padding:'12px 16px' }}>
                          {(blk.exercises||[]).map((ex,ei)=>(
                            <div key={ei} style={{ display:'flex', justifyContent:'space-between', alignItems:'center', padding:'7px 0', borderBottom: ei<blk.exercises.length-1?'1px solid var(--border)':'none' }}>
                              <span style={{ fontSize:'14px' }}>
                                <span style={{ color:'var(--muted)', marginRight:'8px', fontSize:'12px', fontVariantNumeric:'tabular-nums' }}>{ei+1}</span>
                                {ex.description}
                              </span>
                              <span className="font-mono" style={{ fontSize:'12px', color:'var(--ink)', flexShrink:0, marginLeft:'12px' }}>
                                {ex.duration}{ex.unit==='seconds'?'s':' reps'}
                              </span>
                            </div>
                          ))}
                        </div>
                      </div>
                    );
                  })}
                </div>
                <button className="btn-danger" onClick={deleteWorkout} style={{ marginTop:'24px' }}>DELETE WORKOUT</button>
              </div>
            )}

            {/* ‚îÄ‚îÄ EDIT ‚îÄ‚îÄ */}
            {mode==='PLAN' && editMode && editDraft && (
              <div className="fade-in">
                <p style={{ fontSize:'11px', color:'var(--muted)', marginBottom:'16px', textTransform:'uppercase', letterSpacing:'0.06em' }}>
                  Edit blocks and exercises. Tap Save when done.
                </p>
                {(editDraft.categories||[]).map((blk,bi)=>(
                  <BlockEditor key={bi} blk={blk}
                    onChange={u=>{ const c=[...editDraft.categories]; c[bi]=u; setEditDraft(d=>({...d,categories:c})); }}
                    onDelete={()=>setEditDraft(d=>({...d,categories:d.categories.filter((_,i)=>i!==bi)}))} />
                ))}
                <button className="btn-ghost" style={{ width:'100%', marginTop:'8px', fontSize:'12px' }}
                  onClick={()=>setEditDraft(d=>({...d,categories:[...d.categories,{name:'New Block',rounds:3,exercises:[{description:'',duration:30,unit:'seconds',instructions:''}]}]}))}>
                  + ADD BLOCK
                </button>
              </div>
            )}

            {/* ‚îÄ‚îÄ REST ‚îÄ‚îÄ */}
            {mode==='RUN' && curRest && (
              <RestScreen key={idx} duration={curRest.duration} onSkip={next} setFlashTrigger={setFlashTrigger} />
            )}

            {/* ‚îÄ‚îÄ EXERCISE ‚îÄ‚îÄ */}
            {mode==='RUN' && current && curEx && (
              <div className="card slide-up" style={{ padding:'24px' }}>
                <div style={{ display:'flex', gap:'8px', alignItems:'center', marginBottom:'20px', flexWrap:'wrap' }}>
                  {(()=>{
                    const blk=blocks[curEx.bi];
                    const isMat=/mat/i.test(blk?.name||''), isW=/weight/i.test(blk?.name||'');
                    return <span className={`badge ${isMat?'badge-green':isW?'badge-blue':'badge-gray'}`}>{blk?.name}</span>;
                  })()}
                  <span style={{ fontSize:'11px', color:'var(--muted)', textTransform:'uppercase', letterSpacing:'0.06em' }}>
                    Round {curEx.ri}/{curBlock?.rounds}
                  </span>
                  <span style={{ fontSize:'12px', color:'var(--muted)', marginLeft:'auto', fontVariantNumeric:'tabular-nums', fontFamily:'DM Mono,monospace' }}>
                    {idx+1}<span style={{ color:'var(--surface3)' }}>/</span>{schedule.length}
                  </span>
                </div>

                <h2 className="font-display" style={{ fontSize:'clamp(36px,9vw,60px)', fontWeight:900, textTransform:'uppercase', letterSpacing:'0.01em', margin:'0 0 16px', lineHeight:1 }}>
                  {current.description}
                </h2>

                {current.instructions && (
                  <div className="cue-card" style={{ marginBottom:'12px' }}>
                    <div style={{ fontSize:'10px', fontWeight:800, letterSpacing:'0.12em', textTransform:'uppercase', color:'#5a7a00', marginBottom:'6px' }}>Coaching cues</div>
                    <div style={{ fontSize:'14px', lineHeight:'1.65', color:'var(--ink)' }}>{current.instructions}</div>
                  </div>
                )}

                {current.unit==='seconds' ? (
                  (() => {
                    // Detect alternating exercises by name
                    const isAlternating = /lunge|dead.?bug|hip.?flexor|hip.?circle|leg.?swing|clamshell|side.?plank|split.?squat|step.?up|single|lateral|windmill|bird.?dog|skater/i.test(current.description);
                    return (
                      <div>
                        <BigTimer key={seed} ms={toMs(current.duration)} running={running}
                          onToggle={()=>setRunning(r=>!r)}
                          onComplete={()=>{ setFlashTrigger(t=>t+1); setTimerDone(true); }}
                          done={timerDone} />
                        {isAlternating && (
                          <div style={{ display:'flex', flexDirection:'column', alignItems:'center', gap:'8px', marginTop:'16px' }}>
                            <div style={{ fontSize:'11px', color:'var(--muted)', textTransform:'uppercase', letterSpacing:'0.08em', fontWeight:700 }}>
                              {timerDone ? '‚úì Side 1 done ‚Äî flip & go' : 'Each side'}
                            </div>
                            <button className="btn-volt" style={{ fontSize:'13px', padding:'10px 24px' }}
                              onClick={()=>{ setRunning(false); setTimerDone(false); setSeed(s=>s+1); setRunning(true); }}>
                              FLIP ‚Üí OTHER SIDE
                            </button>
                          </div>
                        )}
                      </div>
                    );
                  })()
                ) : (
                  <div style={{ marginTop:'24px' }}>
                    <div style={{ display:'flex', alignItems:'baseline', gap:'10px' }}>
                      <span className="font-display" style={{ fontSize:'96px', fontWeight:900, lineHeight:1, color:'var(--ink)', letterSpacing:'-0.02em' }}>{current.duration}</span>
                      <span className="font-display" style={{ fontSize:'28px', fontWeight:700, color:'var(--muted)', textTransform:'uppercase' }}>reps</span>
                    </div>
                    {/lunge|dead.?bug|hip.?flexor|clamshell|side.?plank|split.?squat|step.?up|single|lateral|windmill|bird.?dog|skater/i.test(current.description) && (
                      <div style={{ fontSize:'12px', color:'var(--muted)', textTransform:'uppercase', letterSpacing:'0.08em', fontWeight:700, marginTop:'4px' }}>per side</div>
                    )}
                    <button className="btn-ink" style={{ marginTop:'20px', fontSize:'14px', padding:'14px 28px' }} onClick={next}>DONE ‚úì</button>
                  </div>
                )}

                {timerDone && (
                  <div style={{ marginTop:'14px', color:'var(--ink)', fontWeight:800, fontSize:'12px', letterSpacing:'0.1em', textTransform:'uppercase' }}>‚úì DONE ‚Äî TAP NEXT</div>
                )}

                <div style={{ display:'flex', gap:'8px', marginTop:'28px' }}>
                  <button className="btn-ghost" onClick={prev} disabled={idx===0} style={{ fontSize:'12px' }}>‚óÄ PREV</button>
                  <button className="btn-ghost" onClick={()=>setMode('PLAN')} style={{ fontSize:'12px' }}>EXIT</button>
                  <button className="btn-ink"  style={{ marginLeft:'auto', fontSize:'13px', padding:'10px 24px' }} onClick={next}>
                    {idx+1>=schedule.length ? 'FINISH üéâ' : 'NEXT ‚Üí'}
                  </button>
                </div>
              </div>
            )}

            {/* ‚îÄ‚îÄ COMPLETE ‚îÄ‚îÄ */}
            {mode==='RUN' && schedule.length>0 && !cur && (
              <div className="card fade-in" style={{ padding:'48px 24px', textAlign:'center' }}>
                <div className="font-display" style={{ fontSize:'72px', fontWeight:900, textTransform:'uppercase', color:'var(--ink)', lineHeight:1 }}>Done.</div>
                <div style={{ color:'var(--muted)', marginTop:'8px', fontSize:'12px', textTransform:'uppercase', letterSpacing:'0.1em' }}>Workout complete</div>
                <button className="btn-ink" style={{ marginTop:'28px' }} onClick={()=>setMode('PLAN')}>BACK TO PLAN</button>
              </div>
            )}
          </main>

          {showImport && <ImportModal onClose={()=>setShowImport(false)} onImport={handleImport} />}
        </div>
      );
    }

    const root = ReactDOM.createRoot(document.getElementById("root"));
    root.render(<App />);
  </script>
</body>
</html>
